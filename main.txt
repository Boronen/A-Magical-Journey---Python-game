from gameCore import Player, Enemy, battle, enemy_templates, SaveManager, safe_input_int
import random

# ================== Party lÃ©trehozÃ¡sa ==================
def create_party():
    party = []
    for i in range(3):
        print(f"\nğŸ® {i+1}. karakter lÃ©trehozÃ¡sa")
        name = input("NÃ©v: ").strip()
        race = input("Faj (orc/elf/human): ").strip().lower()
        pclass = input("OsztÃ¡ly (warrior/thief/mage): ").strip().lower()
        party.append(Player(name, race, pclass))
    return party

# ================== Enemy spawn ==================
def spawn_enemies():
    """EgyszerÅ± pÃ©lda: random szÃ¡mÃº ellenfÃ©l vÃ©letlenszerÅ±en kivÃ¡lasztva"""
    enemy_count = random.randint(1, 3)
    enemies = []
    for _ in range(enemy_count):
        base = random.choice(enemy_templates)
        enemies.append(Enemy(base.name, base.max_hp, base.dmg, base.defense, base.gold, base.exp))
    return enemies

# ================== Falu menÃ¼ ==================
def village_menu(party):
    while True:
        print("\nğŸ˜ï¸ Falu")
        print("1. Kalandra fel (Harc)")
        print("2. Party statok")
        print("3. MentÃ©s")
        print("4. KilÃ©pÃ©s a jÃ¡tÃ©kbÃ³l")
        c = input("> ").strip()

        if c == "1":
            enemies = spawn_enemies()
            print(f"\nğŸ‘¹ {len(enemies)} ellensÃ©g kÃ¶zeledik!")
            battle(party, enemies)

        elif c == "2":
            for p in party:
                p.show_stats()

        elif c == "3":
            # egyszerÅ± mentÃ©s csak az elsÅ‘ karakterre demonstrÃ¡ciÃ³hoz
            slot = safe_input_int("MentÃ©s slot (1-3): ", 1, 3)
            SaveManager.save(party[0], slot)
            print("ğŸ’¾ Mentve (jelenleg csak az elsÅ‘ karakter mentÃ©se van megoldva)")

        elif c == "4":
            print("ğŸ‘‹ KilÃ©pÃ©s a jÃ¡tÃ©kbÃ³l...")
            break

# ================== BetÃ¶ltÃ©s ==================
def load_party():
    slot = safe_input_int("BetÃ¶ltÃ©s slot (1-3): ", 1, 3)
    first_player = SaveManager.load(slot)
    if first_player:
        print("âœ… MentÃ©s betÃ¶ltve.")
        # a pÃ©ldÃ¡ban 1 karaktert tÃ¶ltÃ¼nk vissza, de bÅ‘vÃ­thetÅ‘ 3 karakteres mentÃ©sre is
        party = [first_player]
        # Ã¼res placeholder karakterek, ha nem volt tÃ¶bb mentve
        while len(party) < 3:
            party.append(Player(f"NPC_{len(party)+1}", "human", "warrior"))
        return party
    return None

# ================== FÅ‘menÃ¼ ==================
def main_menu():
    while True:
        print("\n=== ğŸ“œ FÅ‘menÃ¼ ===")
        print("1. Ãšj jÃ¡tÃ©k")
        print("2. BetÃ¶ltÃ©s")
        print("3. KilÃ©pÃ©s")
        choice = input("> ").strip()

        if choice == "1":
            party = create_party()
            village_menu(party)
        elif choice == "2":
            party = load_party()
            if party:
                village_menu(party)
        elif choice == "3":
            print("ğŸ‘‹ ViszlÃ¡t!")
            break

# ================== Program indÃ­tÃ¡s ==================
if __name__ == "__main__":
    main_menu()
